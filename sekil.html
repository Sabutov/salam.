<!doctype html>
<html lang="az">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>≈û…ôkil √ñl√ß√ºs√º D…ôyi≈üdirici</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --accent:#0f172a;
      --muted:#6b7280;
      --radius:14px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#fff);color:var(--accent);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
    .container{width:100%;max-width:980px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:0 6px 20px rgba(12,16,26,0.06);padding:18px;border:1px solid rgba(15,23,42,0.04)}
    .drop{border:2px dashed rgba(15,23,42,0.08);padding:20px;border-radius:12px;display:grid;gap:12px}
    .center{display:flex;align-items:center;justify-content:center}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1;min-width:240px}
    .preview{background:#f9fafb;border:1px solid rgba(15,23,42,0.04);border-radius:10px;padding:12px;max-height:420px;overflow:auto}
    img.preview-img{max-width:100%;height:auto;display:block;margin:0 auto}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input[type="number"], select, input[type="text"]{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(15,23,42,0.06);font-size:14px}
    .btn{padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:#fff;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(15,23,42,0.06)}
    .small{font-size:13px;color:var(--muted)}
    .controls{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .full{grid-column:1/3}
    .flex{display:flex;gap:8px;align-items:center}
    input[type="range"]{width:100%}
    footer{margin-top:14px;text-align:center;color:var(--muted);font-size:13px}
    @media (max-width:720px){.controls{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>≈û…ôkil √ñl√ß√ºs√º D…ôyi≈üdirici</h1>
      <div class="small">Sad…ô v…ô s√ºr…ôtli ‚Äî faylƒ± se√ß, √∂l√ß√ºn√º t…ôyin et, y√ºkl…ô.</div>
    </header>

    <div class="card drop" id="dropzone">
      <div id="dropContent" class="center" style="flex-direction:column;gap:8px;padding:18px">
        <div style="font-size:48px">üì∑</div>
        <div style="text-align:center">
          <div style="font-weight:600">≈û…ôkli bura atƒ±n v…ô ya se√ßin</div>
          <div class="small" style="margin-top:6px">PNG, JPG, WEBP v…ô s. d…ôst…ôkl…ônir</div>
        </div>
        <div class="row center" style="margin-top:6px">
          <button class="btn" id="chooseBtn">Fayl se√ß</button>
          <button class="btn ghost" id="clearBtn">Sƒ±fƒ±rla</button>
        </div>
        <input type="file" id="fileInput" accept="image/*" style="display:none">
      </div>

      <div id="editingArea" style="display:none;gap:14px">
        <div class="row">
          <div class="col preview card">
            <div class="small" id="origInfo">Orijinal: ‚Äî</div>
            <div style="margin-top:10px" class="center">
              <img id="imgPreview" class="preview-img" alt="preview">
            </div>
          </div>

          <div class="col card" style="padding:12px">
            <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:8px">
              <div class="small">H…ôd…ôf √∂l√ß√º</div>
              <div class="small" id="targetInfo">‚Äî √ó ‚Äî px</div>
            </div>

            <div class="controls">
              <div>
                <label>Fayl adƒ±</label>
                <input type="text" id="fileName" value="resized">
              </div>

              <div>
                <label>√ñl√ß√º vahidi</label>
                <select id="unit">
                  <option value="px">Piksel (px)</option>
                  <option value="%">Faiz (%)</option>
                </select>
              </div>

              <div>
                <label>En (<span id="unitLabelW">px</span>)</label>
                <input type="number" id="widthInput" min="1" value="800">
              </div>

              <div>
                <label>H√ºnd√ºrl√ºk (<span id="unitLabelH">px</span>)</label>
                <input type="number" id="heightInput" min="1" value="600">
              </div>

              <div style="display:flex;align-items:center;gap:8px">
                <input type="checkbox" id="lockRatio" checked>
                <label style="margin:0">Nisb…ôti qoru</label>
              </div>

              <div>
                <label>Format</label>
                <select id="format">
                  <option value="png">PNG (≈ü…ôffaf)</option>
                  <option value="jpeg">JPG / JPEG</option>
                  <option value="webp">WEBP</option>
                </select>
              </div>

              <div>
                <label>Keyfiyy…ôt (JPEG/WEBP)</label>
                <input type="range" id="quality" min="1" max="100" value="92">
                <div class="small" style="text-align:right" id="qualityVal">92%</div>
              </div>

              <div class="full">
                <label>Arxa fon r…ôngi (JPEG √º√ß√ºn v…ô ya ≈ü…ôffaflƒ±q yoxdur)</label>
                <input type="color" id="bgColor" value="#ffffff" style="height:44px;padding:4px">
              </div>

            </div>

            <div style="margin-top:12px;display:flex;gap:10px;align-items:center;justify-content:space-between">
              <div class="small">H…ôd…ôf √∂l√ß√º: <strong id="finalSize">‚Äî √ó ‚Äî px</strong></div>
              <div style="display:flex;gap:8px">
                <button class="btn ghost" id="previewBtn">Canvas √∂nizl…ô</button>
                <button class="btn" id="downloadBtn">Y√ºkl…ô</button>
              </div>
            </div>

            <canvas id="canvas" style="display:none;margin-top:10px;width:100%"></canvas>
          </div>
        </div>
      </div>
    </div>

    <footer class="small" style="margin-top:12px">
      Hazƒ±rlandƒ± ‚Äî ≈û…ôkil √∂l√ß√ºs√º d…ôyi≈üdir…ôn sad…ô veb t…ôtbiq.
    </footer>
  </div>

  <script>
    // Elementl…ôr
    const dropzone = document.getElementById('dropzone');
    const dropContent = document.getElementById('dropContent');
    const fileInput = document.getElementById('fileInput');
    const chooseBtn = document.getElementById('chooseBtn');
    const clearBtn = document.getElementById('clearBtn');

    const editingArea = document.getElementById('editingArea');
    const imgPreview = document.getElementById('imgPreview');
    const origInfo = document.getElementById('origInfo');
    const widthInput = document.getElementById('widthInput');
    const heightInput = document.getElementById('heightInput');
    const unitSelect = document.getElementById('unit');
    const unitLabelW = document.getElementById('unitLabelW');
    const unitLabelH = document.getElementById('unitLabelH');
    const lockRatio = document.getElementById('lockRatio');
    const formatSelect = document.getElementById('format');
    const qualityRange = document.getElementById('quality');
    const qualityVal = document.getElementById('qualityVal');
    const bgColor = document.getElementById('bgColor');
    const finalSize = document.getElementById('finalSize');
    const targetInfo = document.getElementById('targetInfo');
    const fileNameInput = document.getElementById('fileName');
    const previewBtn = document.getElementById('previewBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const canvas = document.getElementById('canvas');

    let originalImage = new Image();
    let origW = 0, origH = 0;
    let objectUrl = null;

    // Helpers
    function resetAll(){
      if(objectUrl){ URL.revokeObjectURL(objectUrl); objectUrl = null; }
      originalImage = new Image();
      origW = origH = 0;
      imgPreview.src = '';
      editingArea.style.display = 'none';
      dropContent.style.display = 'flex';
      widthInput.value = 800;
      heightInput.value = 600;
      fileNameInput.value = 'resized';
      finalSize.textContent = '‚Äî √ó ‚Äî px';
      targetInfo.textContent = '‚Äî √ó ‚Äî px';
    }

    function clamp(n,min,max){ return Math.max(min,Math.min(max,n)); }

    // File handling
    function handleFile(file){
      if(!file || !file.type.startsWith('image/')){ alert('Z…ôhm…ôt olmasa ≈ü…ôkil faylƒ± se√ßin.'); return; }
      if(objectUrl){ URL.revokeObjectURL(objectUrl); objectUrl = null; }
      objectUrl = URL.createObjectURL(file);
      originalImage = new Image();
      originalImage.onload = () => {
        origW = originalImage.naturalWidth;
        origH = originalImage.naturalHeight;
        imgPreview.src = objectUrl;
        origInfo.textContent = `Orijinal: ${origW} √ó ${origH}px`;
        // initial inputs
        widthInput.value = origW;
        heightInput.value = origH;
        editingArea.style.display = 'grid';
        dropContent.style.display = 'none';
        updateTargetInfo();
      };
      originalImage.onerror = () => { alert('≈û…ôkili y√ºkl…ôm…ôk m√ºmk√ºn olmadƒ±.'); };
      originalImage.src = objectUrl;
      // set default filename
      const name = file.name ? file.name.replace(/\.[^/.]+$/, '') : 'resized';
      fileNameInput.value = name;
    }

    // Drag & drop
    ['dragenter','dragover'].forEach(ev => {
      dropzone.addEventListener(ev, (e) => { e.preventDefault(); e.stopPropagation(); dropzone.style.borderColor = '#c7cbe0'; });
    });
    ['dragleave','drop'].forEach(ev => {
      dropzone.addEventListener(ev, (e) => { e.preventDefault(); e.stopPropagation(); dropzone.style.borderColor = 'rgba(15,23,42,0.08)'; });
    });
    dropzone.addEventListener('drop', (e) => {
      const f = e.dataTransfer.files && e.dataTransfer.files[0];
      if(f) handleFile(f);
    });

    chooseBtn.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (e) => handleFile(e.target.files && e.target.files[0]));
    clearBtn.addEventListener('click', resetAll);

    // Units and ratio
    unitSelect.addEventListener('change', () => {
      const u = unitSelect.value;
      unitLabelW.textContent = u;
      unitLabelH.textContent = u;
      // if switching to percent, convert current px to percent roughly
      if(origW && origH){
        if(u === '%'){
          widthInput.value = Math.round((Number(widthInput.value)/origW)*100) || 100;
          heightInput.value = Math.round((Number(heightInput.value)/origH)*100) || 100;
        } else {
          // percent -> px
          widthInput.value = Math.round((Number(widthInput.value)/100)*origW) || origW;
          heightInput.value = Math.round((Number(heightInput.value)/100)*origH) || origH;
        }
      }
      updateTargetInfo();
    });

    function aspect(){ return origW && origH ? origW / origH : 1; }

    widthInput.addEventListener('input', () => {
      const u = unitSelect.value;
      const w = Number(widthInput.value) || 1;
      if(lockRatio.checked && aspect()){
        if(u === '%'){
          // keep same percent scaling for height
          const hPct = Math.round(w / aspect());
          heightInput.value = hPct;
        } else {
          const h = Math.round(w / aspect());
          heightInput.value = h;
        }
      }
      updateTargetInfo();
    });

    heightInput.addEventListener('input', () => {
      const u = unitSelect.value;
      const h = Number(heightInput.value) || 1;
      if(lockRatio.checked && aspect()){
        if(u === '%'){
          const wPct = Math.round(h * aspect());
          widthInput.value = wPct;
        } else {
          const w = Math.round(h * aspect());
          widthInput.value = w;
        }
      }
      updateTargetInfo();
    });

    qualityRange.addEventListener('input', ()=> { qualityVal.textContent = qualityRange.value + '%'; });

    function computeTarget(){
      if(!origW || !origH) return {w:0,h:0};
      const u = unitSelect.value;
      if(u === '%'){
        const w = clamp(Math.round((Number(widthInput.value)||100)/100 * origW), 1, 10000);
        const h = clamp(Math.round((Number(heightInput.value)||100)/100 * origH), 1, 10000);
        return {w,h};
      } else {
        const w = clamp(Math.round(Number(widthInput.value)||origW), 1, 20000);
        const h = clamp(Math.round(Number(heightInput.value)||origH), 1, 20000);
        return {w,h};
      }
    }

    function updateTargetInfo(){
      const t = computeTarget();
      finalSize.textContent = `${t.w} √ó ${t.h} px`;
      targetInfo.textContent = `${t.w} √ó ${t.h} px`;
    }

    // Draw to canvas & preview
    function drawToCanvas(){
      const t = computeTarget();
      if(!t.w || !t.h) return null;
      canvas.width = t.w;
      canvas.height = t.h;
      const ctx = canvas.getContext('2d');
      // fill bg
      ctx.fillStyle = bgColor.value || '#ffffff';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      // draw image
      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = 'high';
      ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
      return canvas;
    }

    previewBtn.addEventListener('click', () => {
      if(!originalImage.src){ alert('∆èvv…ôlc…ô ≈ü…ôkil se√ßin.'); return; }
      drawToCanvas();
      // show small preview popup (open image in new tab)
      canvas.toBlob((blob) => {
        if(!blob) return;
        const u = URL.createObjectURL(blob);
        window.open(u, '_blank');
        setTimeout(()=>URL.revokeObjectURL(u), 15000);
      }, formatSelect.value === 'png' ? 'image/png' : formatSelect.value === 'jpeg' ? 'image/jpeg' : 'image/webp', formatSelect.value === 'png' ? undefined : (Number(qualityRange.value)/100));
    });

    // Download
    downloadBtn.addEventListener('click', () => {
      if(!originalImage.src){ alert('∆èvv…ôlc…ô ≈ü…ôkil se√ßin.'); return; }
      const c = drawToCanvas();
      if(!c) return;
      const fmt = formatSelect.value;
      const mime = fmt === 'png' ? 'image/png' : fmt === 'jpeg' ? 'image/jpeg' : 'image/webp';
      const q = fmt === 'png' ? undefined : (Number(qualityRange.value)/100);
      c.toBlob((blob) => {
        if(!blob) { alert('Fayl yaratmaq alƒ±nmadƒ±.'); return; }
        const name = (fileNameInput.value || 'resized').replace(/[\\/:*?"<>|]+/g,'') + `_${c.width}x${c.height}.${fmt === 'jpeg' ? 'jpg' : fmt}`;
        const a = document.createElement('a');
        const u = URL.createObjectURL(blob);
        a.href = u; a.download = name;
        document.body.appendChild(a); a.click(); a.remove();
        setTimeout(()=>URL.revokeObjectURL(u), 2000);
      }, mime, q);
    });

    // init
    resetAll();
  </script>
</body>
</html>
